# CCTV VisionCount AI - Automated Jute Bag Counter

An AI-powered system for automated counting of jute bags using YOLOv8 object detection and tracking.

## ğŸ¯ Features

- **Real-time Jute Bag Detection** - YOLOv8-powered object detection with custom fine-tuned weights
- **Tiled Detection (SAHI-lite)** - Optimized for high-resolution static warehouse pile images
- **Dynamic Analysis Modes** - Specialized logic for **Static**, **Scanning** (center-zone), and **Zone** (conveyor) processing
- **Download Sample Feature** - Instant ZIP download of high-quality sample videos and images for each analysis mode
- **High-Density Flow Optimization** - Enhanced deduplication and ID jump protection for rapid product streams
- **Supabase Authentication** - Secure login system with Email verification
- **Live CCTV Integration** - Real-time MJPEG camera feed with live ROI occupancy metrics
- **Interactive Analytics Dashboard** - Premium glassmorphism UI with real-time charts (ApexCharts), activity logs, and CSV export
- **WebSocket Infrastructure** - Low-latency, bi-directional communication for instant dashboard updates
- **Internal Tools** - Built-in scripts for automated testing (`test_main_dummy.py`) and AI model training (`train_sacks_model.py`)

## ğŸ—ï¸ Technology Stack

### Backend
- **FastAPI** - Modern Python web framework
- **YOLOv8 (ultralytics)** - Object detection and tracking
- **PyTorch** - Deep learning framework
- **OpenCV** - Video processing
- **WebSocket** - Real-time communication

### Frontend
- **Vite** - Next-generation build tool
- **Vanilla JavaScript** - Lightweight and fast
- **Supabase** - Authentication & Backend-as-a-Service
- **CSS3** - Custom design system with modern components

## ğŸ“‹ Prerequisites

- Python 3.8+
- Node.js 16+
- npm or yarn

## ğŸš€ Installation

### 1. Clone the repository
```bash
git clone https://github.com/saipratyushap/CCTV-VisionCount-AI.git
cd CCTV-VisionCount-AI
```

### 2. Download YOLOv8 Model
Download the YOLOv8 medium model and place it in `backend/models/`:
```bash
# Visit https://github.com/ultralytics/assets/releases
# Download yolov8m.pt
# Move it to backend/models/yolov8m.pt
```

Or use Python:
```bash
cd backend
python -c "from ultralytics import YOLO; YOLO('yolov8m.pt')"
mv yolov8m.pt models/
```

### 3. Backend Setup
```bash
cd backend
pip install -r requirements.txt
```

### 4. Frontend Setup
```bash
cd frontend
npm install
```

## ğŸ® Usage

### Start Backend Server
```bash
cd backend
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

The backend will be available at `http://localhost:8000`
- API documentation: `http://localhost:8000/docs`

### Start Frontend Server
```bash
cd frontend
npm run dev
```

The frontend will be available at `http://localhost:5173`

## ğŸ“ Project Structure

```
CCTV_VisionCount_AI/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ main.py             # FastAPI backend server
â”‚   â”‚   â”œâ”€â”€ tracker.py          # YOLOv8 tracker with high-density logic
â”‚   â”‚   â””â”€â”€ zone_tracker.py     # specialized logic for conveyor counting
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ yolov8n.pt          # Base YOLOv8 model
â”‚   â”‚   â””â”€â”€ sacks_custom.pt     # Fine-tuned weights for jute bags
â”‚   â”œâ”€â”€ runs/                   # Training and detection logs
â”‚   â”œâ”€â”€ training_data/          # Roboflow datasets for fine-tuning
â”‚   â”œâ”€â”€ detections/             # Processed media output
â”‚   â”œâ”€â”€ train_sacks_model.py    # Factory: Script to train custom AI models
â”‚   â”œâ”€â”€ test_main_dummy.py      # Safety: Script for automated API testing
â”‚   â””â”€â”€ requirements.txt
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ index.html              # Landing Page
â”‚   â”œâ”€â”€ dashboard.html          # Real-time monitoring hub
â”‚   â”œâ”€â”€ analytics.html          # Glassmorphism data & Trends dashboard
â”‚   â”œâ”€â”€ script.js               # Application logic & ZIP bundling
â”‚   â”œâ”€â”€ style.css               # Premium design system
â”‚   â””â”€â”€ assets/
â”‚       â””â”€â”€ samples/            # Pre-loaded sample bundles (.mp4, .jpg)
â””â”€â”€ README.md
```

## ğŸ”§ Configuration

### Analysis Modes
The system supports three distinct analysis modes:

1. **Static Mode** (Optimized for Images)
   - Uses **Tiled Detection (SAHI-lite)** to count stationary bags in high-res warehouse stacks.
2. **Scanning Mode** (Optimized for Video)
   - Uses a **Center Scanning Zone** logic for dynamic scenes.
3. **Zone Counting Mode** (Optimized for Conveyors)
   - Tracks objects crossing defined boundaries in specialized flow environments.

The **Live Feed** toggle on the dashboard allows for real-time monitoring directly from connected CCTV sources.

## ï¿½ Data Storage & Management

The system uses a hybrid storage approach to ensure performance and reliability:

### Backend (Server-Side)
- **Active Detections**: Annotated videos and images generated by the live application are stored in `backend/detections/`. This folder is required for the dashboard to display your results.
- **Historical Detections**: The root `detections/` folder is used for development/testing snapshots and verification logs. It contains proof-of-work samples from model tuning sessions.
- **Task History**: Permanent records of processing tasks are saved in `backend/data/tasks.json`.
- **Original Uploads**: Raw files uploaded by users are temporarily kept in `backend/uploads/`.

### Frontend (Client-Side Analytics)
- **Browser LocalStorage**: Primary storage for real-time dashboard persistence:
    - `analyticsData`: **The main database for the Analytics Tab**. Stores up to 50 processed task logs (Time, Filename, Count, Status).
    - `currentTotalBags`: Tracks the cumulative session count across page reloads.
    - `recentUploads`: Manages the history list shown in the dashboard sidebar.

## ğŸ”„ Real-Time Dashboard Updates

The dashboard maintains high interactivity through three primary mechanisms:

1. **WebSockets (Push)**: A dedicated `ws://` connection enables the backend to push live count updates and processing statuses directly to the UI without page refreshes.
2. **Task Polling (Pull)**: After an upload, the dashboard polls the status of the specific `task_id` every 2 seconds until completion.
3. **Session Persistence**: On page load, the frontend synchronizes with `localStorage` to restore previous counts and activity logs immediately.

## ï¿½ğŸ“Š API Endpoints

- `POST /upload` - Upload video/image for processing
- `GET /tasks/{task_id}` - Get processing status
- `GET /stream` - MJPEG live camera stream
- `WS /ws` - WebSocket for real-time updates
- `POST /reset` - Reset current session data

## ğŸ¤ Contributing

Contributions are welcome! Please feel free to submit a Pull Request.

## ğŸ“ License

This project is licensed under the MIT License.

## ğŸ™ Acknowledgments

- [Ultralytics YOLOv8](https://github.com/ultralytics/ultralytics) for the object detection model
- [FastAPI](https://fastapi.tiangolo.com/) for the backend framework
- [Vite](https://vitejs.dev/) for the frontend build tool

## ğŸ“§ Contact

For questions or support, please open an issue on GitHub.
